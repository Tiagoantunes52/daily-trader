# Daily Market Tips - Project Structure

## Overview
This document describes the project structure and core configuration setup for the Daily Market Tips application.

## Directory Structure

```
.
├── src/                          # Main application source code
│   ├── __init__.py
│   ├── api/                      # API routes and endpoints
│   │   ├── __init__.py
│   │   └── routes.py             # REST API endpoints for tips and market data
│   ├── database/                 # Database models and initialization
│   │   ├── __init__.py
│   │   ├── db.py                 # Database connection and session management
│   │   └── models.py             # SQLAlchemy ORM models
│   ├── models/                   # Data models (not ORM)
│   │   ├── __init__.py
│   │   ├── market_data.py        # MarketData, HistoricalData, DataSource models
│   │   └── trading_tip.py        # TradingTip, EmailContent, DashboardTip models
│   ├── services/                 # Business logic services
│   │   ├── __init__.py
│   │   ├── analysis_engine.py    # Technical analysis and tip generation
│   │   ├── email_service.py      # Email sending with retry logic
│   │   ├── market_data_aggregator.py  # Market data fetching from APIs
│   │   └── scheduler_service.py  # Scheduled delivery orchestration
│   └── utils/                    # Utility functions
│       ├── __init__.py
│       └── config.py             # Configuration management
├── tests/                        # Test suite
│   ├── __init__.py
│   ├── conftest.py               # Pytest configuration and fixtures
│   └── test_config.py            # Configuration validation tests
├── main.py                       # Application entry point
├── requirements.txt              # Python dependencies
├── .env.example                  # Environment variables template
└── PROJECT_STRUCTURE.md          # This file
```

## Core Configuration

### Environment Variables (.env)
The application uses environment variables for configuration:

- **Email Settings**
  - `SMTP_SERVER`: SMTP server address (default: smtp.gmail.com)
  - `SMTP_PORT`: SMTP port (default: 587)
  - `SENDER_EMAIL`: Email address to send from
  - `SENDER_PASSWORD`: Email password or app-specific password

- **Scheduler Settings**
  - `MORNING_TIME`: Morning delivery time in HH:MM format (default: 06:00)
  - `EVENING_TIME`: Evening delivery time in HH:MM format (default: 18:00)
  - `TIMEZONE`: Timezone for scheduling (default: UTC)

- **API Settings**
  - `CRYPTO_API_KEY`: CoinGecko API key (optional)
  - `STOCK_API_KEY`: Alpha Vantage API key (optional)
  - `CACHE_TTL`: Cache time-to-live in seconds (default: 300)

- **Database Settings**
  - `DATABASE_URL`: Database connection URL (default: sqlite:///./market_tips.db)
  - `DATABASE_ECHO`: Enable SQL logging (default: false)

### Configuration Classes

#### EmailConfig
Manages SMTP and email retry settings:
- `smtp_server`: SMTP server address
- `smtp_port`: SMTP port number
- `sender_email`: Sender email address
- `sender_password`: Sender password
- `retry_delays`: List of retry delays in seconds (default: [300, 900, 1800] = 5min, 15min, 30min)

#### SchedulerConfig
Manages scheduled delivery times:
- `morning_time`: Morning delivery time (HH:MM format)
- `evening_time`: Evening delivery time (HH:MM format)
- `timezone`: Timezone for scheduling (default: UTC)

#### APIConfig
Manages external API settings:
- `crypto_api_key`: Cryptocurrency API key
- `stock_api_key`: Stock market API key
- `cache_ttl`: Cache time-to-live in seconds

#### DatabaseConfig
Manages database connection:
- `database_url`: Database connection URL
- `echo`: Enable SQL query logging

### Configuration Validation
The `Config.validate()` method ensures:
- Email sender address is configured
- Email password is configured
- Delivery times are in valid HH:MM format
- Time values are within valid ranges (0-23 hours, 0-59 minutes)

## Database Schema

### Tables

#### tips
Stores trading tips generated by the analysis engine:
- `id`: Primary key
- `symbol`: Asset symbol (e.g., BTC, AAPL)
- `type`: Asset type (crypto or stock)
- `recommendation`: BUY, SELL, or HOLD
- `reasoning`: Analysis explanation
- `confidence`: Confidence score (0-100)
- `indicators`: Technical indicators used (JSON)
- `sources`: Data sources (JSON)
- `generated_at`: Timestamp
- `delivery_type`: morning or evening

#### market_data
Stores market data snapshots:
- `id`: Primary key
- `symbol`: Asset symbol
- `type`: Asset type (crypto or stock)
- `current_price`: Current price
- `price_change_24h`: 24-hour price change
- `volume_24h`: 24-hour trading volume
- `historical_data`: Historical price data (JSON)
- `source_name`: Data source name
- `source_url`: Data source URL
- `fetched_at`: Timestamp

#### delivery_logs
Tracks email delivery attempts:
- `id`: Primary key
- `recipient`: Recipient email address
- `status`: success, failed, or retrying
- `delivery_type`: morning or evening
- `attempt_number`: Retry attempt number
- `error_message`: Error details if failed
- `attempted_at`: Timestamp

#### user_profiles
Stores user configuration:
- `id`: Primary key
- `email`: User email address (unique)
- `morning_time`: User's preferred morning delivery time
- `evening_time`: User's preferred evening delivery time
- `asset_preferences`: Preferred asset types (JSON)
- `created_at`: Account creation timestamp
- `updated_at`: Last update timestamp

## Data Models

### MarketData
Represents current and historical market information:
- `symbol`: Asset symbol
- `type`: crypto or stock
- `current_price`: Current market price
- `price_change_24h`: 24-hour price change
- `volume_24h`: 24-hour trading volume
- `historical_data`: HistoricalData object
- `source`: DataSource object

### TradingTip
Represents a trading recommendation:
- `symbol`: Asset symbol
- `type`: crypto or stock
- `recommendation`: BUY, SELL, or HOLD
- `reasoning`: Analysis explanation
- `confidence`: Confidence score (0-100)
- `indicators`: List of technical indicators
- `sources`: List of TipSource objects
- `generated_at`: Timestamp

### EmailContent
Represents formatted email content:
- `recipient`: Recipient email address
- `subject`: Email subject
- `delivery_type`: morning or evening
- `tips`: List of TradingTip objects
- `market_data`: List of MarketData objects
- `generated_at`: Timestamp

## API Endpoints

### GET /api/tips
Retrieve market tips with optional filtering:
- Query parameters:
  - `asset_type`: Filter by "crypto" or "stock"
  - `days`: Number of past days to retrieve
  - `skip`: Pagination offset
  - `limit`: Maximum results (1-100)

### GET /api/market-data
Get current and historical market data:
- Query parameters:
  - `symbols`: List of symbols to retrieve

### GET /api/tip-history
Get historical tips from past N days:
- Query parameters:
  - `days`: Number of past days (1-90)

### GET /health
Health check endpoint

## Testing

### Test Configuration (conftest.py)
- In-memory SQLite database for testing
- Test database session fixture
- Test client with dependency injection

### Configuration Tests (test_config.py)
- Email configuration defaults
- Scheduler configuration defaults
- Configuration validation for missing values
- Configuration validation for invalid time formats
- Configuration validation for valid configurations

## Requirements

### Python Dependencies
- `fastapi==0.104.1`: Web framework
- `uvicorn==0.24.0`: ASGI server
- `sqlalchemy==2.0.23`: ORM
- `python-dotenv==1.0.0`: Environment variable management
- `requests==2.31.0`: HTTP client
- `pytest==7.4.3`: Testing framework
- `hypothesis==6.88.0`: Property-based testing

## Next Steps

1. Implement Market Data Aggregator (Task 2)
2. Implement Analysis Engine (Task 3)
3. Implement Email Service (Task 4)
4. Implement Scheduler Service (Task 5)
5. Implement Dashboard API (Task 6)
6. Implement Dashboard Web UI (Task 7)
7. Implement User Configuration Management (Task 8)
8. Integration and End-to-End Testing (Task 10)
